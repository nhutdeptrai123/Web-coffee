@model dynamic

@{
    ViewData["Title"] = "Home - manage_coffee_shop_web";
    var bannerImagePath = ViewBag.BannerImagePath ?? "/images/banners/default.jpg"; // Fallback image
    var bannerTitle = string.IsNullOrEmpty(ViewBag.BannerTitle) ? "No Title" : ViewBag.BannerTitle;
    var bannerDescription = string.IsNullOrEmpty(ViewBag.BannerDescription) ? "No Description" : ViewBag.BannerDescription;
}

<!-- Banner Section -->
<header class="banner" data-image="@bannerImagePath" style="min-height: 400px; position: relative;">
    <div class="container" style="position: relative; z-index: 1; height: 100%; display: flex; align-items: center; justify-content: center; text-align: center;">
        <div class="banner-content" style="background: rgba(0, 0, 0, 0.5); padding: 2rem; border-radius: 5px; color: #fff;">
            <h4 style="margin: 0; font-size: 2.5rem;">@bannerTitle</h4>
            <p style="margin: 1rem 0; font-size: 1.5rem;">@bannerDescription</p>
        </div>
    </div>
</header>

<!-- Home Section (#US001) -->
<section class="home" id="home" style="min-height: 100vh; background: url('/images/home/home-img.jpg') no-repeat; background-size: cover; background-position: center; display: flex; align-items: center;">
    <div class="content">
        <h3 style="color: white; font-weight: bold; font-size: 36px;">
            FRESH COFFEE WITH CHICKEN CAFÉ
        </h3>
        <p style="color: #FFFFFF; font-size: 30px; font-weight: 500;">
            "Hãy bắt đầu bằng một ngày mới trọn vẹn luôn bắt đầu bằng hương thơm nồng nàn của tách cà phê"
        </p>
        <a href="#products" class="btn">GYBAU NOW</a>
    </div>
</section>

<!-- About Section -->
<section class="about" id="about" style="margin-bottom: 0; padding-bottom: 20px;">
    <div class="container">
        <h1 class="heading" style="border-bottom: 2px solid #4A2C2A; padding-bottom: 10px; padding-top: 10px">
            <span>VỀ </span> CHICKEN CAFÉ
        </h1>
        <div class="row">
            <div class="image col-md-6">
                <img src="/images/home/about-img.png" alt="About Us" class="img-fluid">
            </div>
            <div class="content col-md-6">
                <h3>Điều gì làm cho cà phê của chúng tôi trở nên đặc biệt?</h3>
                <p>
                    Chúng tôi tin rằng một tách cà phê ngon không chỉ đơn giản là thức uống,
                    mà còn là trải nghiệm. Từ những hạt cà phê nguyên chất được tuyển chọn kỹ lưỡng,
                    rang xay chuẩn mực, cho đến cách pha chế tận tâm, tất cả đều nhằm mang đến cho bạn
                    hương vị đậm đà và trọn vẹn nhất.
                </p>
                <p>
                    Chicken Café không chỉ phục vụ cà phê, chúng tôi trao gửi năng lượng tích cực
                    để khởi đầu ngày mới, sẻ chia khoảnh khắc và gắn kết mọi người.
                    Mỗi tách cà phê là một câu chuyện, và chúng tôi rất vui được viết tiếp câu chuyện cùng bạn.
                </p>
                <a href="#" class="btn">Learn More</a>
            </div>
        </div>
    </div>
</section>

<!-- Products Section (#US002) -->
<section class="products" id="products" style="margin-top: -250px; padding-top: 20px;">
    <div class="container">
        <h1 class="heading" style="border-bottom: 2px solid #4A2C2A; padding-bottom: 10px; padding-top: 10px">
            <span>SẢN </span> PHẨM
        </h1>
        <div class="row">
            <div class="col-md-3 filter-sidebar">
                <h5>Filter by Category</h5>
                <select class="form-select mb-3" id="categoryFilter">
                    <option value="">All Categories</option>
                    @foreach (var category in ViewBag.Categories ?? Enumerable.Empty<dynamic>())
                    {
                        <option value="@category.Id">@category.Name</option>
                    }
                </select>
            </div>
            <div class="col-md-9">
                <div class="row row-cols-1 row-cols-md-3 g-4">
                    @foreach (var product in ViewBag.Products ?? Enumerable.Empty<dynamic>())
                    {
                        <div class="col">
                            <div class="card product-card h-100">
                                <img src="@product.ImageUrl" class="card-img-top" alt="@product.Name" loading="lazy" />
                                <div class="card-body">
                                    <h5 class="card-title">@product.Name</h5>
                                    <p class="card-text price">@product.Price</p>
                                    <a href="@Url.Action("Details", "Product", new { id = product.Id })" class="btn btn-sm">View Details</a>
                                    <a href="#" class="btn btn-sm btn-success add-to-cart mt-2" data-id="@product.Id">Add to Cart</a>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Menu Section (#US006, #US007) -->
<section class="menu" id="menu">
    <div class="container">
        <h1 class="heading" style="border-bottom: 2px solid #4A2C2A; padding-bottom: 10px; padding-top: 10px">
            THỰC <span>ĐƠN</span>
        </h1>
        <div class="row">
            <div class="col-md-3 filter-sidebar">
                <h5>Filter by Category</h5>
                <select class="form-select mb-3" id="menuFilter">
                    <option value="">All Categories</option>
                    @foreach (var category in ViewBag.MenuCategories ?? Enumerable.Empty<dynamic>())
                    {
                        <option value="@category.Id">@category.Name</option>
                    }
                </select>
            </div>
            <div class="col-md-9">
                <div class="row row-cols-1 row-cols-md-3 g-4">
                    @foreach (var item in ViewBag.MenuItems ?? Enumerable.Empty<dynamic>())
                    {
                        <div class="col">
                            <div class="card menu-item @(item.IsFeatured ? "border-primary" : "") h-100">
                                <img src="@item.ImageUrl" class="card-img-top" alt="@item.Name" loading="lazy" />
                                <div class="card-body">
                                    <h5 class="card-title">@item.Name @(item.IsFeatured ? "<span class='badge bg-success'>Featured</span>" : "")</h5>
                                    <p class="card-text price">@item.Price</p>
                                    <a href="@Url.Action("Details", "Menu", new { id = item.Id })" class="btn btn-sm">View Details</a>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Reviews Section -->
<section class="reviews" id="reviews">
    <div class="container">
        <h1 class="heading" style="border-bottom: 2px solid #4A2C2A; padding-bottom: 10px; padding-top: 10px">
            ĐÁNH GIÁ<span> KHÁCH HÀNG</span>
        </h1>
        <div class="row row-cols-1 row-cols-md-3 g-4">
            @foreach (var review in ViewBag.Reviews ?? Enumerable.Empty<dynamic>())
            {
                <div class="col">
                    <div class="card h-100">
                        <div class="card-body">
                            <p class="card-text">@review.Content</p>
                            <img src="@review.UserImageUrl" alt="@review.UserName" class="rounded-circle mt-3" style="width: 50px; height: 50px;" />
                            <h6 class="mt-2">@review.UserName</h6>
                            <div class="stars">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    <i class="fas fa-star @(i <= review.Rating ? "" : "fa-star-o")"></i>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</section>

<!-- Contact Section (#US009, #US010) -->
<section class="contact" id="contact">
    <div class="container">
        <h1 class="heading" style="border-bottom: 2px solid #4A2C2A; padding-bottom: 10px; padding-top: 10px">
            <span>LIÊN</span> HỆ
        </h1>
        <div class="row">
            <div class="col-md-6">
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3920.0987465358617!2d106.6372448509867!3d10.72686676604185!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31752ff232d1450b%3A0x3659e3c94323e995!2sCoffee%20BOTT!5e0!3m2!1sen!2s!4v1753882951554!5m2!1sen!2s" width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                <p class="mt-3"><i class="fas fa-map-marker-alt"></i> 123 Coffee St, Ho Chi Minh City</p>
                <p><i class="fas fa-phone"></i> +84 123 456 789</p>
                <p><i class="fas fa-envelope"></i> info@coffeehaven.com</p>
                <p><i class="fas fa-clock"></i> Mon-Fri: 8 AM - 10 PM</p>
            </div>
            <div class="col-md-6">
                <form id="contactForm" method="post" asp-action="Contact" asp-controller="Home" class="needs-validation" novalidate>
                    <h3>Get in Touch</h3>
                    <div class="mb-3">
                        <input type="text" class="form-control" name="Name" placeholder="Your Name" required />
                        <div class="invalid-feedback">Please enter your name.</div>
                    </div>
                    <div class="mb-3">
                        <input type="email" class="form-control" name="Email" placeholder="Your Email" required />
                        <div class="invalid-feedback">Please enter a valid email.</div>
                    </div>
                    <div class="mb-3">
                        <input type="tel" class="form-control" name="Phone" placeholder="Your Phone" required />
                        <div class="invalid-feedback">Please enter a valid phone number.</div>
                    </div>
                    <button type="submit" class="btn">Send Message</button>
                </form>
                <div id="contactMessage" class="mt-2 text-success" style="display:none;"></div>
            </div>
        </div>
    </div>
</section>

<script>
    // Add to cart
    document.querySelectorAll('.add-to-cart').forEach(button => {
        button.addEventListener('click', (e) => {
            e.preventDefault();
            const productId = button.getAttribute('data-id');
            fetch('/Cart/Add', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ productId, quantity: 1 })
            }).then(response => response.json()).then(data => {
                alert(data.message || 'Added to cart!');
                // Update cart UI (implement reload or live update)
            }).catch(error => console.error('Error:', error));
        });
    });

    // Contact form validation and submission
    (function () {
        'use strict';
        const form = document.getElementById('contactForm');
        form.addEventListener('submit', function (e) {
            e.preventDefault();
            if (form.checkValidity()) {
                fetch(form.action, {
                    method: 'POST',
                    body: new FormData(form)
                }).then(response => response.json()).then(data => {
                    document.getElementById('contactMessage').textContent = data.message;
                    document.getElementById('contactMessage').style.display = 'block';
                    form.reset();
                    form.classList.remove('was-validated');
                }).catch(error => console.error('Error:', error));
            } else {
                form.classList.add('was-validated');
            }
        });
    })();

    document.addEventListener("DOMContentLoaded", function () {
        const banner = document.querySelector(".banner");
        const imagePath = banner.getAttribute("data-image");
        if (imagePath) {
            banner.style.backgroundImage = `url('${imagePath}')`;
            console.log("Setting background image to: ", imagePath);
        } else {
            console.log("No image path found for banner.");
        }
    });
</script>