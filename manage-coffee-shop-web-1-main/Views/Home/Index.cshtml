@model dynamic

@{
    ViewData["Title"] = "Home - manage_coffee_shop_web";
    var bannerImagePath = ViewBag.BannerImagePath ?? "/images/banners/default.jpg"; // Fallback image if null
    var bannerTitle = string.IsNullOrEmpty(ViewBag.BannerTitle) ? "No Title" : ViewBag.BannerTitle;
    var bannerDescription = string.IsNullOrEmpty(ViewBag.BannerDescription) ? "No Description" : ViewBag.BannerDescription;
}

<!-- Banner Section -->
<header class="banner" data-image="@bannerImagePath">
</header>

<!-- Products Section (#US002) -->
<section class="products" id="products">
    <div class="container">
        <h1 class="heading"><span>Our</span> Menu</h1>
        <!-- Advanced Search Form -->
        <form asp-action="Index" asp-controller="Search" method="get" class="search-form">
            <div class="row mb-3">
                <div class="col-md-3">
                    <label for="categoryId" class="form-label">Category</label>
                    <select class="form-select" id="categoryId" name="categoryId">
                        <option value="">All Categories</option>
                        @foreach (var category in ViewBag.Categories ?? Enumerable.Empty<dynamic>())
                        {
                            if (ViewBag.SelectedCategoryId.HasValue && category.Id == ViewBag.SelectedCategoryId)
                            {
                                <option value="@category.Id" selected>@category.Name</option>
                            }
                            else
                            {
                                <option value="@category.Id">@category.Name</option>
                            }
                        }
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="searchTerm" class="form-label">Product Name</label>
                    <input type="text" class="form-control" id="searchTerm" name="searchTerm" value="@ViewBag.SearchTerm" placeholder="Enter name..." />
                </div>
                <div class="col-md-3">
                    <label for="minPrice" class="form-label">Min Price</label>
                    <input type="number" class="form-control" id="minPrice" name="minPrice" value="@ViewBag.MinPrice" min="0" step="0.01" placeholder="Min..." />
                </div>
                <div class="col-md-3">
                    <label for="maxPrice" class="form-label">Max Price</label>
                    <input type="number" class="form-control" id="maxPrice" name="maxPrice" value="@ViewBag.MaxPrice" min="0" step="0.01" placeholder="Max..." />
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Search</button>
        </form>
        <div class="row">
            <div class="col-md-12">
                <div class="row row-cols-1 row-cols-md-3 g-4">
                    @foreach (var product in ViewBag.Products ?? Enumerable.Empty<dynamic>())
                    {
                        <div class="col">
                            <div class="card product-card h-100">
                                <a href="@Url.Action("Details", "Product", new { id = product.Id })">
                                    <img src="@product.Image" class="card-img-top" alt="@product.Name" loading="lazy" />
                                </a>
                                <div class="card-body">
                                    <h5 class="card-title">@product.Name</h5>
                                    <p class="card-text price">@product.Price</p>
                                    <a href="@Url.Action("Details", "Product", new { id = product.Id })" class="btn btn-sm">View Details</a>
                                    <a href="#" class="btn btn-sm btn-success add-to-cart mt-2" data-id="@product.Id">Add to Cart</a>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Home Section (#US001) -->
<section class="home" id="home">
    <div class="content">
        <h3>Fresh Coffee with BOTT COFFEE</h3>
        <p>
            “Cà phê luôn đậm đà, thơm mới, nhân viên thân thiện và không gian ấm cúng.
            Đây là quán ruột của tôi – đặc biệt thích các hương vị theo mùa!”
            <br>
            <strong>Jane D., Khách hàng thân thiết</strong>
        </p>
        <a href="#products" class="btn">Get Yours Now</a>
    </div>
</section>

<!-- About Section -->
<section class="about" id="about">
    <div class="container">
        <h1 class="heading"><span>About</span> Us</h1>
        <div class="row">
            <div class="image col-md-6">
                <img src="/images/home/about-img.png" alt="About Us" class="img-fluid">
            </div>
            <div class="content col-md-6">
                <h3>Điều Gì Làm Cà Phê Chúng Tôi Đặc Biệt?</h3>
                <p>
                    Từ những góc vỉa hè quen thuộc, nơi hương cà phê rang hòa cùng nhịp sống đô thị, chúng tôi mang đến những ly cà phê đậm đà và trà thanh mát.
                </p>
                <p>
                    Mỗi tách đều được chăm chút để bạn tìm thấy năng lượng tích cực cho ngày mới, sự tỉnh táo cho công việc và chút bình yên giữa guồng quay bận rộn. Ở đây, cà phê và trà không chỉ để thưởng thức, mà còn để kết nối con người và câu chuyện.
                </p>
                <a href="#" class="btn">Learn More</a>
            </div>
        </div>
    </div>
</section>



<!-- Menu Section (#US006, #US007) -->
<section class="menu" id="menu">
    <div class="container">
        <h1 class="heading"><span>Our</span> Product</h1>
        <div class="row">
            <div class="col-md-3 filter-sidebar">
                <h5>Filter by Category</h5>
                <select class="form-select mb-3" id="menuFilter">
                    <option value="">All Categories</option>
                    @foreach (var category in ViewBag.MenuCategories ?? Enumerable.Empty<dynamic>())
                    {
                        <option value="@category.Id">@category.Name</option>
                    }
                </select>
            </div>
            <div class="col-md-9">
                <div class="row row-cols-1 row-cols-md-3 g-4">
                    @foreach (var item in ViewBag.MenuItems ?? Enumerable.Empty<dynamic>())
                    {
                        <div class="col">
                            <div class="card menu-item @(item.IsFeatured ? "border-primary" : "") h-100">
                                <img src="@item.ImageUrl" class="card-img-top" alt="@item.Name" loading="lazy" />
                                <div class="card-body">
                                    <h5 class="card-title">@item.Name @(item.IsFeatured ? "<span class='badge bg-success'>Featured</span>" : "")</h5>
                                    <p class="card-text price">@item.Price</p>
                                    <a href="@Url.Action("Details", "Menu", new { id = item.Id })" class="btn btn-sm">View Details</a>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Reviews Section -->
<section class="reviews" id="reviews">
    <div class="container">
        <h1 class="heading"><span>Customer</span> Reviews</h1>
        <div class="row row-cols-1 row-cols-md-3 g-4">
            @foreach (var review in ViewBag.Reviews ?? Enumerable.Empty<dynamic>())
            {
                <div class="col">
                    <div class="card h-100">
                        <div class="card-body">
                            <p class="card-text">@review.Content</p>
                            <img src="@review.UserImageUrl" alt="@review.UserName" class="rounded-circle mt-3" style="width: 50px; height: 50px;" />
                            <h6 class="mt-2">@review.UserName</h6>
                            <div class="stars">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    <i class="fas fa-star @(i <= review.Rating ? "" : "fa-star-o")"></i>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</section>

<!-- Contact Section (#US009, #US010) -->
<section class="contact" id="contact">
    <div class="container">
        <h1 class="heading"><span>Contact</span> Us</h1>
        <div class="row">
            <div class="col-md-6">
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3920.0987465358617!2d106.6372448509867!3d10.72686676604185!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31752ff232d1450b%3A0x3659e3c94323e995!2sCoffee%20BOTT!5e0!3m2!1sen!2s!4v1753882951554!5m2!1sen!2s" width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                <p class="mt-3"><i class="fas fa-map-marker-alt"></i> 123 Coffee St, Ho Chi Minh City</p>
                <p><i class="fas fa-phone"></i> +84 123 456 789</p>
                <p><i class="fas fa-envelope"></i> info@coffeehaven.com</p>
                <p><i class="fas fa-clock"></i> Mon-Fri: 8 AM - 10 PM</p>
            </div>
            <div class="col-md-6">
                <form id="contactForm" method="post" asp-action="Contact" asp-controller="Home" class="needs-validation" novalidate>
                    <h3>Get in Touch</h3>
                    <div class="mb-3">
                        <input type="text" class="form-control" name="Name" placeholder="Your Name" required />
                        <div class="invalid-feedback">Please enter your name.</div>
                    </div>
                    <div class="mb-3">
                        <input type="email" class="form-control" name="Email" placeholder="Your Email" required />
                        <div class="invalid-feedback">Please enter a valid email.</div>
                    </div>
                    <div class="mb-3">
                        <input type="tel" class="form-control" name="Phone" placeholder="Your Phone" required />
                        <div class="invalid-feedback">Please enter a valid phone number.</div>
                    </div>
                    <button type="submit" class="btn">Send Message</button>
                </form>
                <div id="contactMessage" class="mt-2 text-success" style="display:none;"></div>
            </div>
        </div>
    </div>
</section>

<!-- Blogs Section (#US008) -->
<section class="blogs" id="blogs">
    <div class="container">
        <h1 class="heading"><span>Our</span> Blogs</h1>
        <div class="row row-cols-1 row-cols-md-3 g-4">
            @foreach (var blog in ViewBag.Blogs ?? Enumerable.Empty<dynamic>())
            {
                <div class="col">
                    <div class="card h-100">
                        <img src="@blog.ImageUrl" class="card-img-top" alt="@blog.Title" loading="lazy" />
                        <div class="card-body">
                            <h5 class="card-title">@blog.Title</h5>
                            <p class="card-text">@blog.Content.Substring(0, 100)...</p>
                            <p class="text-muted">by @blog.Author on @blog.Date.ToString("dd/MM/yyyy")</p>
                            <a href="@Url.Action("Details", "Blog", new { id = blog.Id })" class="btn btn-sm">Read More</a>
                        </div>
                    </div>
                </div>
            }
        </div>
        <nav class="mt-4">
            <ul class="pagination justify-content-center">
                @for (int i = 1; i <= ViewBag.TotalPages; i++)
                {
                    <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                        <a class="page-link" href="@Url.Action("Index", new { page = i })">@i</a>
                    </li>
                }
            </ul>
        </nav>
    </div>
</section>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const banner = document.querySelector(".banner");
        const imagePath = banner.getAttribute("data-image");
        if (imagePath) {
            banner.style.backgroundImage = `url('${imagePath}')`;
        }
    });

    // Add to cart
    document.querySelectorAll('.add-to-cart').forEach(button => {
        button.addEventListener('click', (e) => {
            e.preventDefault();
            const productId = button.getAttribute('data-id');
            fetch('/Cart/Add', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ productId, quantity: 1 })
            }).then(response => response.json()).then(data => {
                alert(data.message || 'Added to cart!');
            }).catch(error => console.error('Error:', error));
        });
    });

    // Contact form validation and submission
    (function () {
        'use strict';
        const form = document.getElementById('contactForm');
        form.addEventListener('submit', function (e) {
            e.preventDefault();
            if (form.checkValidity()) {
                fetch(form.action, {
                    method: 'POST',
                    body: new FormData(form)
                }).then(response => response.json()).then(data => {
                    document.getElementById('contactMessage').textContent = data.message;
                    document.getElementById('contactMessage').style.display = 'block';
                    form.reset();
                    form.classList.remove('was-validated');
                }).catch(error => console.error('Error:', error));
            } else {
                form.classList.add('was-validated');
            }
        });
    })();
</script>